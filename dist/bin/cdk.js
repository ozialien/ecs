#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = require("aws-cdk-lib");
const ecs_service_stack_1 = require("../lib/ecs-service-stack");
/**
 * CDK App Entry Point
 *
 * Uses CDK's native context parameters (-c) for configuration
 *
 * Usage:
 *   # Context parameters only
 *   cdk deploy -c vpcId=vpc-12345678 -c image=nginx:alpine
 *
 *   # With values file (Helm-style)
 *   cdk deploy -c valuesFile=values.yaml
 */
const app = new cdk.App();
// Load configuration from context parameters
const config = {
    vpcId: app.node.tryGetContext('vpcId') || process.env.VPC_ID,
    subnetIds: app.node.tryGetContext('subnetIds') || process.env.SUBNET_IDS?.split(','),
    clusterName: app.node.tryGetContext('clusterName') || process.env.CLUSTER_NAME,
    image: app.node.tryGetContext('image') || process.env.IMAGE,
    stackName: app.node.tryGetContext('stackName') || process.env.STACK_NAME,
    desiredCount: app.node.tryGetContext('desiredCount') || parseInt(process.env.DESIRED_COUNT || '1'),
    cpu: app.node.tryGetContext('cpu') || parseInt(process.env.CPU || '256'),
    memory: app.node.tryGetContext('memory') || parseInt(process.env.MEMORY || '512'),
    containerPort: app.node.tryGetContext('containerPort') || parseInt(process.env.CONTAINER_PORT || ''),
    lbPort: app.node.tryGetContext('lbPort') || parseInt(process.env.LB_PORT || ''),
    healthCheckPath: app.node.tryGetContext('healthCheckPath') || process.env.HEALTH_CHECK_PATH || '/',
    allowedCidr: app.node.tryGetContext('allowedCidr') || process.env.ALLOWED_CIDR || '0.0.0.0/0',
    environment: app.node.tryGetContext('env') || {},
    secrets: app.node.tryGetContext('secret') || {},
    logGroupName: app.node.tryGetContext('logGroupName') || process.env.LOG_GROUP_NAME,
    logRetentionDays: app.node.tryGetContext('logRetentionDays') || parseInt(process.env.LOG_RETENTION_DAYS || '7'),
    enableAutoScaling: app.node.tryGetContext('enableAutoScaling') || process.env.ENABLE_AUTO_SCALING === 'true',
    minCapacity: app.node.tryGetContext('minCapacity') || parseInt(process.env.MIN_CAPACITY || '1'),
    maxCapacity: app.node.tryGetContext('maxCapacity') || parseInt(process.env.MAX_CAPACITY || '3'),
    targetCpuUtilization: app.node.tryGetContext('targetCpuUtilization') || parseInt(process.env.TARGET_CPU_UTILIZATION || '70'),
    targetMemoryUtilization: app.node.tryGetContext('targetMemoryUtilization') || parseInt(process.env.TARGET_MEMORY_UTILIZATION || '70'),
    taskExecutionRoleArn: app.node.tryGetContext('taskExecutionRoleArn') || process.env.TASK_EXECUTION_ROLE_ARN,
    taskRoleArn: app.node.tryGetContext('taskRoleArn') || process.env.TASK_ROLE_ARN,
    taskRolePermissions: app.node.tryGetContext('taskRolePermissions'),
    taskExecutionRolePermissions: app.node.tryGetContext('taskExecutionRolePermissions'),
    valuesFile: app.node.tryGetContext('valuesFile'),
};
// Load from values file if specified
if (config.valuesFile) {
    const fs = require('fs');
    const path = require('path');
    if (fs.existsSync(config.valuesFile)) {
        try {
            const fileContent = fs.readFileSync(config.valuesFile, 'utf8');
            const ext = path.extname(config.valuesFile).toLowerCase();
            let values;
            switch (ext) {
                case '.js':
                    values = require(path.resolve(config.valuesFile));
                    break;
                case '.yaml':
                case '.yml':
                    const yaml = require('js-yaml');
                    values = yaml.load(fileContent);
                    break;
                default:
                    values = JSON.parse(fileContent);
            }
            // Merge values into config
            Object.assign(config, values);
        }
        catch (error) {
            console.warn(`⚠️  Warning: Failed to parse values file ${config.valuesFile}: ${error}`);
        }
    }
    else {
        console.warn(`⚠️  Warning: Values file not found: ${config.valuesFile}`);
    }
}
// Validate required parameters
const requiredParams = ['vpcId', 'subnetIds', 'clusterName', 'image', 'stackName', 'containerPort', 'lbPort'];
for (const param of requiredParams) {
    if (!config[param]) {
        console.error(`❌ Error: Required parameter '${param}' is missing.`);
        console.error('   Use -c parameter or set environment variable.');
        console.error('');
        console.error('Examples:');
        console.error('  cdk deploy -c vpcId=vpc-12345678 -c image=nginx:alpine');
        console.error('  cdk deploy -c valuesFile=values.yaml');
        process.exit(1);
    }
}
// Create the ECS service stack using stack name
new ecs_service_stack_1.EcsServiceStack(app, config.stackName, {
    env: {
        account: process.env.CDK_DEFAULT_ACCOUNT,
        region: process.env.CDK_DEFAULT_REGION,
    },
    config,
});
app.synth();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2RrLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vYmluL2Nkay50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFFQSxtQ0FBbUM7QUFDbkMsZ0VBQTJEO0FBRzNEOzs7Ozs7Ozs7OztHQVdHO0FBRUgsTUFBTSxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUM7QUFFMUIsNkNBQTZDO0FBQzdDLE1BQU0sTUFBTSxHQUFxQjtJQUMvQixLQUFLLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNO0lBQzVELFNBQVMsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxXQUFXLENBQUMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFVBQVUsRUFBRSxLQUFLLENBQUMsR0FBRyxDQUFDO0lBQ3BGLFdBQVcsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxhQUFhLENBQUMsSUFBSSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVk7SUFDOUUsS0FBSyxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsS0FBSztJQUMzRCxTQUFTLEVBQUUsR0FBRyxDQUFDLElBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVO0lBQ3hFLFlBQVksRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxjQUFjLENBQUMsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLElBQUksR0FBRyxDQUFDO0lBQ2xHLEdBQUcsRUFBRSxHQUFHLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsSUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLElBQUks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QUMsSUFBSSxDQUFDLHVDQUF1QyxNQUFNLENBQUMsVUFBVSxFQUFFLENBQUMsQ0FBQztLQUMxRTtDQUNGO0FBRVcsK0JBQStCO0FBQy9CLE1BQU0sY0FBYyxHQUFHLENBQUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxlQUFlLEVBQUUsUUFBUSxDQUFDLENBQUM7QUFDMUgsS0FBSyxNQUFNLEtBQUssSUFBSSxjQUFjLEVBQUU7SUFDbEMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUErQixDQUFDLEVBQUU7UUFDNUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxnQ0FBZ0MsS0FBSyxlQUFlLENBQUMsQ0FBQztRQUNwRSxPQUFPLENBQUMsS0FBSyxDQUFDLGtEQUFrRCxDQUFDLENBQUM7UUFDbEUsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQixPQUFPLENBQUMsS0FBSyxDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBQzNCLE9BQU8sQ0FBQyxLQUFLLENBQUMsMERBQTBELENBQUMsQ0FBQztRQUMxRSxPQUFPLENBQUMsS0FBSyxDQUFDLHdDQUF3QyxDQUFDLENBQUM7UUFDeEQsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztLQUNqQjtDQUNGO0FBRUQsZ0RBQWdEO0FBQ2hELElBQUksbUNBQWUsQ0FBQyxHQUFHLEVBQUUsTUFBTSxDQUFDLFNBQVMsRUFBRTtJQUN6QyxHQUFHLEVBQUU7UUFDSCxPQUFPLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUI7UUFDeEMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCO0tBQ3ZDO0lBQ0QsTUFBTTtDQUNQLENBQUMsQ0FBQztBQUVILEdBQUcsQ0FBQyxLQUFLLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcblxuaW1wb3J0ICogYXMgY2RrIGZyb20gJ2F3cy1jZGstbGliJztcbmltcG9ydCB7IEVjc1NlcnZpY2VTdGFjayB9IGZyb20gJy4uL2xpYi9lY3Mtc2VydmljZS1zdGFjayc7XG5pbXBvcnQgeyBFY3NTZXJ2aWNlQ29uZmlnIH0gZnJvbSAnLi4vbGliL3R5cGVzJztcblxuLyoqXG4gKiBDREsgQXBwIEVudHJ5IFBvaW50XG4gKiBcbiAqIFVzZXMgQ0RLJ3MgbmF0aXZlIGNvbnRleHQgcGFyYW1ldGVycyAoLWMpIGZvciBjb25maWd1cmF0aW9uXG4gKiBcbiAqIFVzYWdlOlxuICogICAjIENvbnRleHQgcGFyYW1ldGVycyBvbmx5XG4gKiAgIGNkayBkZXBsb3kgLWMgdnBjSWQ9dnBjLTEyMzQ1Njc4IC1jIGltYWdlPW5naW54OmFscGluZVxuICogICBcbiAqICAgIyBXaXRoIHZhbHVlcyBmaWxlIChIZWxtLXN0eWxlKVxuICogICBjZGsgZGVwbG95IC1jIHZhbHVlc0ZpbGU9dmFsdWVzLnlhbWxcbiAqL1xuXG5jb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xuXG4vLyBMb2FkIGNvbmZpZ3VyYXRpb24gZnJvbSBjb250ZXh0IHBhcmFtZXRlcnNcbmNvbnN0IGNvbmZpZzogRWNzU2VydmljZUNvbmZpZyA9IHtcbiAgdnBjSWQ6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ3ZwY0lkJykgfHwgcHJvY2Vzcy5lbnYuVlBDX0lELFxuICBzdWJuZXRJZHM6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ3N1Ym5ldElkcycpIHx8IHByb2Nlc3MuZW52LlNVQk5FVF9JRFM/LnNwbGl0KCcsJyksXG4gIGNsdXN0ZXJOYW1lOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdjbHVzdGVyTmFtZScpIHx8IHByb2Nlc3MuZW52LkNMVVNURVJfTkFNRSxcbiAgaW1hZ2U6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2ltYWdlJykgfHwgcHJvY2Vzcy5lbnYuSU1BR0UsXG4gIHN0YWNrTmFtZTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnc3RhY2tOYW1lJykgfHwgcHJvY2Vzcy5lbnYuU1RBQ0tfTkFNRSxcbiAgZGVzaXJlZENvdW50OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdkZXNpcmVkQ291bnQnKSB8fCBwYXJzZUludChwcm9jZXNzLmVudi5ERVNJUkVEX0NPVU5UIHx8ICcxJyksXG4gIGNwdTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnY3B1JykgfHwgcGFyc2VJbnQocHJvY2Vzcy5lbnYuQ1BVIHx8ICcyNTYnKSxcbiAgbWVtb3J5OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdtZW1vcnknKSB8fCBwYXJzZUludChwcm9jZXNzLmVudi5NRU1PUlkgfHwgJzUxMicpLFxuICAgICAgICAgICAgICAgIGNvbnRhaW5lclBvcnQ6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2NvbnRhaW5lclBvcnQnKSB8fCBwYXJzZUludChwcm9jZXNzLmVudi5DT05UQUlORVJfUE9SVCB8fCAnJyksXG4gICAgICAgICAgICAgIGxiUG9ydDogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnbGJQb3J0JykgfHwgcGFyc2VJbnQocHJvY2Vzcy5lbnYuTEJfUE9SVCB8fCAnJyksXG4gIGhlYWx0aENoZWNrUGF0aDogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnaGVhbHRoQ2hlY2tQYXRoJykgfHwgcHJvY2Vzcy5lbnYuSEVBTFRIX0NIRUNLX1BBVEggfHwgJy8nLFxuICBhbGxvd2VkQ2lkcjogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnYWxsb3dlZENpZHInKSB8fCBwcm9jZXNzLmVudi5BTExPV0VEX0NJRFIgfHwgJzAuMC4wLjAvMCcsXG4gIGVudmlyb25tZW50OiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCdlbnYnKSB8fCB7fSxcbiAgc2VjcmV0czogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnc2VjcmV0JykgfHwge30sXG4gIGxvZ0dyb3VwTmFtZTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnbG9nR3JvdXBOYW1lJykgfHwgcHJvY2Vzcy5lbnYuTE9HX0dST1VQX05BTUUsXG4gIGxvZ1JldGVudGlvbkRheXM6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2xvZ1JldGVudGlvbkRheXMnKSB8fCBwYXJzZUludChwcm9jZXNzLmVudi5MT0dfUkVURU5USU9OX0RBWVMgfHwgJzcnKSxcbiAgZW5hYmxlQXV0b1NjYWxpbmc6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ2VuYWJsZUF1dG9TY2FsaW5nJykgfHwgcHJvY2Vzcy5lbnYuRU5BQkxFX0FVVE9fU0NBTElORyA9PT0gJ3RydWUnLFxuICBtaW5DYXBhY2l0eTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgnbWluQ2FwYWNpdHknKSB8fCBwYXJzZUludChwcm9jZXNzLmVudi5NSU5fQ0FQQUNJVFkgfHwgJzEnKSxcbiAgbWF4Q2FwYWNpdHk6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ21heENhcGFjaXR5JykgfHwgcGFyc2VJbnQocHJvY2Vzcy5lbnYuTUFYX0NBUEFDSVRZIHx8ICczJyksXG4gIHRhcmdldENwdVV0aWxpemF0aW9uOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCd0YXJnZXRDcHVVdGlsaXphdGlvbicpIHx8IHBhcnNlSW50KHByb2Nlc3MuZW52LlRBUkdFVF9DUFVfVVRJTElaQVRJT04gfHwgJzcwJyksXG4gIHRhcmdldE1lbW9yeVV0aWxpemF0aW9uOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCd0YXJnZXRNZW1vcnlVdGlsaXphdGlvbicpIHx8IHBhcnNlSW50KHByb2Nlc3MuZW52LlRBUkdFVF9NRU1PUllfVVRJTElaQVRJT04gfHwgJzcwJyksXG4gIHRhc2tFeGVjdXRpb25Sb2xlQXJuOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCd0YXNrRXhlY3V0aW9uUm9sZUFybicpIHx8IHByb2Nlc3MuZW52LlRBU0tfRVhFQ1VUSU9OX1JPTEVfQVJOLFxuICB0YXNrUm9sZUFybjogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgndGFza1JvbGVBcm4nKSB8fCBwcm9jZXNzLmVudi5UQVNLX1JPTEVfQVJOLFxuICB0YXNrUm9sZVBlcm1pc3Npb25zOiBhcHAubm9kZS50cnlHZXRDb250ZXh0KCd0YXNrUm9sZVBlcm1pc3Npb25zJyksXG4gIHRhc2tFeGVjdXRpb25Sb2xlUGVybWlzc2lvbnM6IGFwcC5ub2RlLnRyeUdldENvbnRleHQoJ3Rhc2tFeGVjdXRpb25Sb2xlUGVybWlzc2lvbnMnKSxcbiAgdmFsdWVzRmlsZTogYXBwLm5vZGUudHJ5R2V0Q29udGV4dCgndmFsdWVzRmlsZScpLFxufTtcblxuLy8gTG9hZCBmcm9tIHZhbHVlcyBmaWxlIGlmIHNwZWNpZmllZFxuaWYgKGNvbmZpZy52YWx1ZXNGaWxlKSB7XG4gIGNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbiAgY29uc3QgcGF0aCA9IHJlcXVpcmUoJ3BhdGgnKTtcbiAgXG4gIGlmIChmcy5leGlzdHNTeW5jKGNvbmZpZy52YWx1ZXNGaWxlKSkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBmaWxlQ29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhjb25maWcudmFsdWVzRmlsZSwgJ3V0ZjgnKTtcbiAgICAgIGNvbnN0IGV4dCA9IHBhdGguZXh0bmFtZShjb25maWcudmFsdWVzRmlsZSkudG9Mb3dlckNhc2UoKTtcbiAgICAgIFxuICAgICAgbGV0IHZhbHVlczogYW55O1xuICAgICAgc3dpdGNoIChleHQpIHtcbiAgICAgICAgY2FzZSAnLmpzJzpcbiAgICAgICAgICB2YWx1ZXMgPSByZXF1aXJlKHBhdGgucmVzb2x2ZShjb25maWcudmFsdWVzRmlsZSkpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICcueWFtbCc6XG4gICAgICAgIGNhc2UgJy55bWwnOlxuICAgICAgICAgIGNvbnN0IHlhbWwgPSByZXF1aXJlKCdqcy15YW1sJyk7XG4gICAgICAgICAgdmFsdWVzID0geWFtbC5sb2FkKGZpbGVDb250ZW50KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICB2YWx1ZXMgPSBKU09OLnBhcnNlKGZpbGVDb250ZW50KTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gTWVyZ2UgdmFsdWVzIGludG8gY29uZmlnXG4gICAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgdmFsdWVzKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gIFdhcm5pbmc6IEZhaWxlZCB0byBwYXJzZSB2YWx1ZXMgZmlsZSAke2NvbmZpZy52YWx1ZXNGaWxlfTogJHtlcnJvcn1gKTtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS53YXJuKGDimqDvuI8gIFdhcm5pbmc6IFZhbHVlcyBmaWxlIG5vdCBmb3VuZDogJHtjb25maWcudmFsdWVzRmlsZX1gKTtcbiAgfVxufVxuXG4gICAgICAgICAgICAvLyBWYWxpZGF0ZSByZXF1aXJlZCBwYXJhbWV0ZXJzXG4gICAgICAgICAgICBjb25zdCByZXF1aXJlZFBhcmFtcyA9IFsndnBjSWQnLCAnc3VibmV0SWRzJywgJ2NsdXN0ZXJOYW1lJywgJ2ltYWdlJywgJ3N0YWNrTmFtZScsICdjb250YWluZXJQb3J0JywgJ2xiUG9ydCddO1xuZm9yIChjb25zdCBwYXJhbSBvZiByZXF1aXJlZFBhcmFtcykge1xuICBpZiAoIWNvbmZpZ1twYXJhbSBhcyBrZXlvZiBFY3NTZXJ2aWNlQ29uZmlnXSkge1xuICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBFcnJvcjogUmVxdWlyZWQgcGFyYW1ldGVyICcke3BhcmFtfScgaXMgbWlzc2luZy5gKTtcbiAgICBjb25zb2xlLmVycm9yKCcgICBVc2UgLWMgcGFyYW1ldGVyIG9yIHNldCBlbnZpcm9ubWVudCB2YXJpYWJsZS4nKTtcbiAgICBjb25zb2xlLmVycm9yKCcnKTtcbiAgICBjb25zb2xlLmVycm9yKCdFeGFtcGxlczonKTtcbiAgICBjb25zb2xlLmVycm9yKCcgIGNkayBkZXBsb3kgLWMgdnBjSWQ9dnBjLTEyMzQ1Njc4IC1jIGltYWdlPW5naW54OmFscGluZScpO1xuICAgIGNvbnNvbGUuZXJyb3IoJyAgY2RrIGRlcGxveSAtYyB2YWx1ZXNGaWxlPXZhbHVlcy55YW1sJyk7XG4gICAgcHJvY2Vzcy5leGl0KDEpO1xuICB9XG59XG5cbi8vIENyZWF0ZSB0aGUgRUNTIHNlcnZpY2Ugc3RhY2sgdXNpbmcgc3RhY2sgbmFtZVxubmV3IEVjc1NlcnZpY2VTdGFjayhhcHAsIGNvbmZpZy5zdGFja05hbWUsIHtcbiAgZW52OiB7XG4gICAgYWNjb3VudDogcHJvY2Vzcy5lbnYuQ0RLX0RFRkFVTFRfQUNDT1VOVCxcbiAgICByZWdpb246IHByb2Nlc3MuZW52LkNES19ERUZBVUxUX1JFR0lPTixcbiAgfSxcbiAgY29uZmlnLFxufSk7XG5cbmFwcC5zeW50aCgpOyAiXX0=